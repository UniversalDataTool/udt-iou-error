const test = require("ava")
const { getIOU } = require("./index.js")

const ex = {
  ann1: [
    {
      id: "7302463678960538",
      color: "#2196f3",
      points: [
        { x: 0.5357904781771579, y: 0.21360090917555488 },
        { x: 0.4810163339104486, y: 0.2737574958496871 },
        { x: 0.46418827636539073, y: 0.29245533756641817 },
        { x: 0.4118343195585439, y: 0.3734793183389193 },
        { x: 0.3875271253267935, y: 0.4258332751457661 },
        { x: 0.36135014692337014, y: 0.47320114082815135 },
        { x: 0.32395446348990814, y: 0.5292946659783444 },
        { x: 0.29497280882897503, y: 0.5629507810684603 },
        { x: 0.2893634563139557, y: 0.5878812366907683 },
        { x: 0.25196777288049366, y: 0.6589330352143462 },
        { x: 0.16113645800938978, y: 0.7746231756024414 },
        { x: 0.15351360318945537, y: 0.8372999818996797 },
        { x: 0.1293745629263298, y: 0.8915069495081022 },
        { x: 0.07156791387516061, y: 0.993145013773894 },
        { x: 0.08300219610506221, y: 0.9990739008560653 },
        { x: 0.15541931689443897, y: 0.8720263205238253 },
        { x: 0.18146407086254815, y: 0.7957977723244813 },
        { x: 0.21195549014228574, y: 0.7407438208471774 },
        { x: 0.29777748508648466, y: 0.6153047378753072 },
        { x: 0.3230195714040715, y: 0.5604577355062295 },
        { x: 0.3744386361250818, y: 0.49937811923157466 },
        { x: 0.4118343195585439, y: 0.41835413845907365 },
        { x: 0.4810163339104486, y: 0.30616708815868754 },
        { x: 0.5483285640906803, y: 0.22763615294841727 },
        { x: 0.5847893554383058, y: 0.1752821961415704 },
        { x: 0.6119012259275658, y: 0.10298387483687713 },
        { x: 0.6894972690519995, y: 0.02694598518883763 },
        { x: 0.7044555424253843, y: 0.003262052347645012 },
        { x: 0.680148348193634, y: -0.0017240387768165933 },
        { x: 0.6212501467859313, y: 0.06434166862229969 },
        { x: 0.5978778446400175, y: 0.0805464647767999 },
        { x: 0.5903987079533252, y: 0.11420257986691573 },
        { x: 0.5698310820649211, y: 0.1653100138926472 },
      ],
      regionType: "polygon",
      classification: "stem",
    },
    {
      id: "5529819152842215",
      color: "#2196f3",
      points: [
        { x: 0.7201152557393822, y: 0.005494877086579884 },
        { x: 0.744920318123535, y: 0.003549381997626701 },
        { x: 0.7259517410062416, y: 0.03467730342087738 },
        { x: 0.6486183112203533, y: 0.12027908733481667 },
        { x: 0.5946308225019029, y: 0.21171735651561543 },
        { x: 0.5800396093347542, y: 0.27202770427316353 },
        { x: 0.5406433337834526, y: 0.347902012742337 },
        { x: 0.4955856675232973, y: 0.44867865835011095 },
        { x: 0.4563644865300015, y: 0.5184052023381924 },
        { x: 0.408738766752428, y: 0.6790252768821657 },
        { x: 0.4012680656108478, y: 0.7001922634499762 },
        { x: 0.4040695785389404, y: 0.7138885488762066 },
        { x: 0.38445898804229245, y: 0.736300652300947 },
        { x: 0.352987972178881, y: 0.7998006557546323 },
        { x: 0.2687155945526184, y: 0.9931314044266463 },
        { x: 0.24888679981702727, y: 0.9914790048653472 },
        { x: 0.31580898204964747, y: 0.8394582452258147 },
        { x: 0.34183427514011094, y: 0.7717098632125448 },
        { x: 0.37653466592739554, y: 0.7089186798831727 },
        { x: 0.4241702470304759, y: 0.5567946452710589 },
        { x: 0.4280430585022711, y: 0.5180665305531076 },
        { x: 0.46677117322022266, y: 0.45868342131891526 },
        { x: 0.5539094313356135, y: 0.2650428477291574 },
        { x: 0.5655278657509991, y: 0.21340536143855554 },
        { x: 0.6274928492997215, y: 0.09980289159923109 },
      ],
      regionType: "polygon",
      classification: "stem",
    },
  ],
  ann2: [
    {
      regionType: "polygon",
      id: "2744929760041752",
      classification: "stem",
      color: "#2196f3",
      points: [
        { x: 0.42970391811025405, y: 0.3415454956448023 },
        { x: 0.519422831395941, y: 0.2300030629112455 },
        { x: 0.5679195412800961, y: 0.15240832709659727 },
        { x: 0.5715567945214078, y: 0.21545404994599895 },
        { x: 0.4491026020639161, y: 0.3657938505868799 },
      ],
    },
  ],
}

test("Varying the order of the annotation regions shouldn't cause the IOU to change", async (t) => {
  const version1 = ex
  const version2 = { ann1: [ex.ann1[1], ex.ann1[0]], ann2: ex.ann2 }

  const iou1 = getIOU(version1.ann1, version1.ann2)
  const iou2 = getIOU(version2.ann1, version2.ann2)

  t.is(iou1.toFixed(3), iou2.toFixed(3))
})
